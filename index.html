<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wordle Score Analyzer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f0fdf4 0%, #dbeafe 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .card { 
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 20px;
        }
        h1 { font-size: 2rem; color: #1f2937; margin-bottom: 20px; }
        h2 { font-size: 1.5rem; color: #1f2937; margin-bottom: 15px; }
        .upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .upload-area:hover { border-color: #10b981; background: #f0fdf4; }
        .upload-area input { display: none; }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        .btn-secondary { background: #e5e7eb; color: #374151; }
        .btn-secondary:hover { background: #d1d5db; }
        .btn-secondary.active { background: #2563eb; color: white; }
        .btn-success { background: #10b981; color: white; margin-left: auto; }
        .btn-success:hover { background: #059669; }
        .controls { display: flex; gap: 10px; margin: 20px 0; }
        .info-box {
            background: #dbeafe;
            border: 1px solid #93c5fd;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #1e40af;
        }
        .success-box {
            background: #d1fae5;
            border: 1px solid #6ee7b7;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        .winner-banner {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            text-align: center;
            padding: 40px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; }
        th { border-bottom: 2px solid #e5e7eb; font-weight: 600; color: #374151; }
        td { border-bottom: 1px solid #f3f4f6; }
        tr:nth-child(even) { background: #f9fafb; }
        .text-green { color: #10b981; font-weight: bold; }
        .text-center { text-align: center; }
        .hidden { display: none; }
        canvas { width: 100%; height: 400px; border-radius: 8px; }
        .run { background: #d1fae5; border: 1px solid #6ee7b7; padding: 12px; border-radius: 8px; margin-bottom: 10px; }
        .rut { background: #fee2e2; border: 1px solid #fca5a5; padding: 12px; border-radius: 8px; margin-bottom: 10px; }
        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-box { background: #f9fafb; padding: 15px; border-radius: 8px; }
        .stat-label { font-size: 0.875rem; color: #6b7280; margin-bottom: 5px; }
        .stat-value { font-size: 1.75rem; font-weight: bold; color: #1f2937; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>üéØ Wordle Score Analyzer</h1>
            
            <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                <div style="font-size: 4rem; margin-bottom: 10px;">üì§</div>
                <h3>Upload WhatsApp Chat</h3>
                <p style="color: #6b7280; margin-top: 10px; font-size: 14px;">Click to select .txt file</p>
                <input type="file" id="fileInput" accept=".txt">
            </div>
            
            <div id="instructions" class="info-box">
                <strong>How to export from WhatsApp:</strong>
                <ol style="margin-left: 20px; margin-top: 10px;">
                    <li>Open your Wordle chat in WhatsApp</li>
                    <li>Tap the menu (‚ãÆ) ‚Üí More ‚Üí Export chat</li>
                    <li>Select "Without Media"</li>
                    <li>Upload the .txt file here</li>
                </ol>
            </div>
            
            <div id="controls" class="controls hidden">
                <button class="btn btn-secondary active" onclick="switchMode('penalty')">Penalty Scores</button>
                <button class="btn btn-secondary" onclick="switchMode('raw')">Raw Scores</button>
                <button class="btn btn-success" onclick="exportResults()">üì§ Export Results</button>
            </div>
            
            <div id="info" class="success-box hidden"></div>
        </div>
        
        <div id="results" class="hidden"></div>
    </div>

    <script>
        let rawData = [];
        let penaltyData = [];
        let players = [];
        let currentMode = 'penalty';
        const playerColors = ['#ef4444', '#3b82f6', '#10b981', '#f59e0b', '#8b5cf6', '#ec4899'];

        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                parseChat(event.target.result);
            };
            reader.readAsText(file);
        });

        function parseChat(text) {
            const lines = text.split('\n');
            const scores = [];
            const playerSet = new Set();
            
            const wordlePattern = /Wordle ([\d,]+) ([X1-6])\/6/i;
            
            lines.forEach(line => {
                const msgMatch = line.match(/\[(.*?)\] (.*?): (.*)/);
                if (!msgMatch) return;
                
                const name = msgMatch[2];
                const message = msgMatch[3];
                const wordleMatch = message.match(wordlePattern);
                
                if (wordleMatch) {
                    const wordleNum = parseInt(wordleMatch[1].replace(/,/g, ''));
                    const score = wordleMatch[2] === 'X' ? 7 : parseInt(wordleMatch[2]);
                    
                    scores.push({ wordleNumber: wordleNum, player: name.trim(), score: score });
                    playerSet.add(name.trim());
                }
            });
            
            rawData = scores;
            players = Array.from(playerSet);
            penaltyData = applyPenalties(scores, players);
            
            document.getElementById('instructions').classList.add('hidden');
            document.getElementById('controls').classList.remove('hidden');
            document.getElementById('info').classList.remove('hidden');
            document.getElementById('info').innerHTML = '<strong>‚úÖ Success!</strong> Found ' + scores.length + ' scores from ' + players.length + ' players: ' + players.join(', ');
            
            displayResults();
        }

        function applyPenalties(scores, playerList) {
            const allWordles = [...new Set(scores.map(s => s.wordleNumber))].sort((a, b) => a - b);
            const penalized = [...scores];
            
            allWordles.forEach(wordleNum => {
                const scoresForDay = scores.filter(s => s.wordleNumber === wordleNum);
                const playersWhoPosted = scoresForDay.map(s => s.player);
                const playersWhoMissed = playerList.filter(p => !playersWhoPosted.includes(p));
                
                if (playersWhoMissed.length > 0 && scoresForDay.length > 0) {
                    const worstScore = Math.max(...scoresForDay.map(s => s.score));
                    const penaltyScore = worstScore + 1;
                    
                    playersWhoMissed.forEach(player => {
                        penalized.push({
                            wordleNumber: wordleNum,
                            player: player,
                            score: penaltyScore,
                            isPenalty: true
                        });
                    });
                }
            });
            return penalized;
        }

        function calculateStats(scores, playerList) {
            const stats = {};
            
            playerList.forEach(player => {
                const playerScores = scores.filter(s => s.player === player);
                const validScores = playerScores.filter(s => s.score <= 6);
                const sortedScores = [...playerScores].sort((a, b) => a.wordleNumber - b.wordleNumber);
                
                let maxStreak = 0, tempStreak = 0, expectedNum = null;
                
                for (let i = 0; i < sortedScores.length; i++) {
                    const isSuccess = sortedScores[i].score <= 6;
                    const isConsecutive = expectedNum === null || sortedScores[i].wordleNumber === expectedNum;
                    
                    if (isSuccess && isConsecutive) {
                        tempStreak++;
                        maxStreak = Math.max(maxStreak, tempStreak);
                        expectedNum = sortedScores[i].wordleNumber + 1;
                    } else if (isSuccess) {
                        tempStreak = 1;
                        expectedNum = sortedScores[i].wordleNumber + 1;
                    } else {
                        tempStreak = 0;
                        expectedNum = sortedScores[i].wordleNumber + 1;
                    }
                }
                
                let currentStreak = 0;
                expectedNum = null;
                for (let i = sortedScores.length - 1; i >= 0; i--) {
                    const isSuccess = sortedScores[i].score <= 6;
                    const isConsecutive = expectedNum === null || sortedScores[i].wordleNumber === expectedNum;
                    if (isSuccess && isConsecutive) {
                        currentStreak++;
                        expectedNum = sortedScores[i].wordleNumber - 1;
                    } else {
                        break;
                    }
                }
                
                const recentWordleNum = Math.max(...playerScores.map(s => s.wordleNumber));
                const weekScores = playerScores.filter(s => s.wordleNumber >= recentWordleNum - 7 && s.score <= 6);
                const weekAvg = weekScores.length > 0 ? (weekScores.reduce((sum, s) => sum + s.score, 0) / weekScores.length).toFixed(2) : 'N/A';
                
                stats[player] = {
                    total: playerScores.length,
                    average: validScores.length > 0 ? (validScores.reduce((sum, s) => sum + s.score, 0) / validScores.length).toFixed(2) : 'N/A',
                    weekAverage: weekAvg,
                    currentStreak: currentStreak,
                    maxStreak: maxStreak
                };
            });
            return stats;
        }

        function getRunsAndRuts(player, scores) {
            const playerScores = scores.filter(d => d.player === player).sort((a, b) => a.wordleNumber - b.wordleNumber);
            const validScores = playerScores.filter(s => s.score <= 6);
            const overallAvg = validScores.length > 0 ? validScores.reduce((sum, s) => sum + s.score, 0) / validScores.length : 4;
            
            const runsRuts = [];
            const windowSize = 10;
            
            for (let i = 0; i <= playerScores.length - windowSize; i++) {
                const window = playerScores.slice(i, i + windowSize).filter(s => s.score <= 6);
                if (window.length < windowSize) continue;
                
                const windowAvg = window.reduce((sum, s) => sum + s.score, 0) / window.length;
                const diff = windowAvg - overallAvg;
                
                if (Math.abs(diff) > 0.4) {
                    const lastPeriod = runsRuts[runsRuts.length - 1];
                    const currentStart = playerScores[i].wordleNumber;
                    const currentEnd = playerScores[i + windowSize - 1].wordleNumber;
                    
                    if (lastPeriod && currentStart <= lastPeriod.end + 1 && 
                        ((diff < 0 && lastPeriod.type === 'run') || (diff > 0 && lastPeriod.type === 'rut'))) {
                        lastPeriod.end = currentEnd;
                        lastPeriod.avg = windowAvg.toFixed(2);
                        lastPeriod.length = lastPeriod.end - lastPeriod.start + 1;
                        lastPeriod.diff = diff.toFixed(2);
                    } else if (!lastPeriod || currentStart > lastPeriod.end + 1) {
                        runsRuts.push({
                            start: currentStart,
                            end: currentEnd,
                            length: windowSize,
                            avg: windowAvg.toFixed(2),
                            diff: diff.toFixed(2),
                            type: diff < 0 ? 'run' : 'rut'
                        });
                    }
                }
            }
            return runsRuts.filter(p => p.length >= 15);
        }

        function drawChart(canvasId, scores) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth * 2;
            const height = canvas.height = 800;
            
            ctx.clearRect(0, 0, width, height);
            
            const padding = { top: 40, right: 200, bottom: 60, left: 80 };
            const chartWidth = width - padding.left - padding.right;
            const chartHeight = height - padding.top - padding.bottom;
            
            const wordleNumbers = [...new Set(scores.map(d => d.wordleNumber))].sort((a, b) => a - b);
            
            const avgData = wordleNumbers.map((num) => {
                const entry = { wordleNumber: num };
                players.forEach(player => {
                    const playerScores = scores.filter(d => d.player === player && d.wordleNumber <= num);
                    const validScores = playerScores.filter(s => s.score <= 6);
                    if (validScores.length > 0) {
                        entry[player] = validScores.reduce((sum, s) => sum + s.score, 0) / validScores.length;
                    }
                });
                return entry;
            });
            
            const minY = 3.6, maxY = 4.5;
            const xScale = chartWidth / (avgData.length - 1 || 1);
            const yScale = chartHeight / (maxY - minY);
            
            // Grid
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            for (let y = 3.6; y <= 4.5; y += 0.1) {
                const yPos = padding.top + chartHeight - ((y - minY) * yScale);
                ctx.beginPath();
                ctx.moveTo(padding.left, yPos);
                ctx.lineTo(width - padding.right, yPos);
                ctx.stroke();
                
                if (Math.abs(y % 0.2) < 0.01) {
                    ctx.fillStyle = '#6b7280';
                    ctx.font = '24px sans-serif';
                    ctx.textAlign = 'right';
                    ctx.fillText(y.toFixed(1), padding.left - 15, yPos + 8);
                }
            }
            
            // Axes
            ctx.strokeStyle = '#374151';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(padding.left, padding.top);
            ctx.lineTo(padding.left, height - padding.bottom);
            ctx.lineTo(width - padding.right, height - padding.bottom);
            ctx.stroke();
            
            // Lines
            players.forEach((player, idx) => {
                ctx.strokeStyle = playerColors[idx % playerColors.length];
                ctx.lineWidth = 4;
                ctx.beginPath();
                
                let started = false;
                avgData.forEach((d, i) => {
                    if (d[player] !== undefined && d[player] >= minY && d[player] <= maxY) {
                        const x = padding.left + (i * xScale);
                        const y = padding.top + chartHeight - ((d[player] - minY) * yScale);
                        
                        if (!started) {
                            ctx.moveTo(x, y);
                            started = true;
                        } else {
                            ctx.lineTo(x, y);
                        }
                    }
                });
                ctx.stroke();
            });
            
            // Legend
            players.forEach((player, idx) => {
                const y = padding.top + (idx * 50);
                ctx.fillStyle = playerColors[idx % playerColors.length];
                ctx.fillRect(width - padding.right + 20, y, 40, 6);
                ctx.fillStyle = '#374151';
                ctx.font = '28px sans-serif';
                ctx.textAlign = 'left';
                ctx.fillText(player, width - padding.right + 70, y + 8);
            });
            
            // Title
            ctx.fillStyle = '#1f2937';
            ctx.font = 'bold 32px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Cumulative Average Over Time', width / 2, 30);
        }

        function switchMode(mode) {
            currentMode = mode;
            const buttons = document.querySelectorAll('.controls .btn-secondary');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            displayResults();
        }

        function exportResults() {
            const scores = currentMode === 'raw' ? rawData : penaltyData;
            const stats = calculateStats(scores, players);
            
            const winner = players.reduce((best, player) => {
                const playerAvg = parseFloat(stats[player].weekAverage);
                const bestAvg = parseFloat(stats[best].weekAverage);
                if (isNaN(playerAvg)) return best;
                if (isNaN(bestAvg)) return player;
                return playerAvg < bestAvg ? player : best;
            });
            
            // Build HTML string without template literals
            let htmlContent = '<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Wordle Results</title>';
            htmlContent += '<style>* { margin: 0; padding: 0; box-sizing: border-box; }body { font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif; background: linear-gradient(135deg, #f0fdf4 0%, #dbeafe 100%); min-height: 100vh; padding: 20px; }.container { max-width: 1200px; margin: 0 auto; }.card { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 30px; margin-bottom: 20px; }h1 { font-size: 2rem; color: #1f2937; margin-bottom: 20px; }h2 { font-size: 1.5rem; color: #1f2937; margin-bottom: 15px; }.winner-banner { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: white; text-align: center; padding: 40px; border-radius: 12px; margin-bottom: 20px; }table { width: 100%; border-collapse: collapse; }th, td { padding: 12px; text-align: left; }th { border-bottom: 2px solid #e5e7eb; font-weight: 600; color: #374151; }td { border-bottom: 1px solid #f3f4f6; }tr:nth-child(even) { background: #f9fafb; }.text-green { color: #10b981; font-weight: bold; }.text-center { text-align: center; }canvas { width: 100%; height: 400px; }.run { background: #d1fae5; border: 1px solid #6ee7b7; padding: 12px; border-radius: 8px; margin-bottom: 10px; }.rut { background: #fee2e2; border: 1px solid #fca5a5; padding: 12px; border-radius: 8px; margin-bottom: 10px; }.stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }.stat-box { background: #f9fafb; padding: 15px; border-radius: 8px; }.stat-label { font-size: 0.875rem; color: #6b7280; margin-bottom: 5px; }.stat-value { font-size: 1.75rem; font-weight: bold; color: #1f2937; }</style></head><body>';
            
            htmlContent += '<div class="container"><div class="card"><h1>üéØ Wordle Score Results</h1><p style="color: #6b7280;">Generated: ' + new Date().toLocaleString() + '</p><p style="color: #6b7280; margin-top: 10px;">' + scores.length + ' scores from ' + players.length + ' players: ' + players.join(', ') + '</p></div>';
            
            htmlContent += '<div class="winner-banner"><h2 style="font-size: 2rem; margin-bottom: 10px;">üèÜ Wordler of the Week üèÜ</h2><p style="font-size: 1.5rem; font-weight: 600;">' + winner + '</p></div>';
            
            htmlContent += '<div class="card"><h2>Performance Summary</h2><table><thead><tr><th>Player</th><th class="text-center">Week Avg</th><th class="text-center">All-Time</th><th class="text-center">Streak</th><th class="text-center">Max</th></tr></thead><tbody>';
            
            players.sort((a, b) => parseFloat(stats[a].average) - parseFloat(stats[b].average)).forEach(player => {
                htmlContent += '<tr><td style="font-weight: 600;">' + player + '</td><td class="text-center">' + stats[player].weekAverage + '</td><td class="text-center text-green">' + stats[player].average + '</td><td class="text-center">' + stats[player].currentStreak + '</td><td class="text-center">' + stats[player].maxStreak + '</td></tr>';
            });
            
            htmlContent += '</tbody></table></div>';
            
            htmlContent += '<div class="card"><h2>Cumulative Average Chart</h2><canvas id="chart"></canvas></div>';
            
            htmlContent += '<div class="card"><h2>Detailed Player Statistics</h2>';
            
            players.forEach(player => {
                const runsRuts = getRunsAndRuts(player, scores);
                htmlContent += '<div style="margin-bottom: 30px; padding-bottom: 30px; border-bottom: 1px solid #e5e7eb;"><h3 style="font-size: 1.25rem; margin-bottom: 15px;">' + player + '</h3><div class="stat-grid">';
                htmlContent += '<div class="stat-box"><div class="stat-label">All-Time Average</div><div class="stat-value text-green">' + stats[player].average + '</div></div>';
                htmlContent += '<div class="stat-box"><div class="stat-label">Week Average</div><div class="stat-value">' + stats[player].weekAverage + '</div></div>';
                htmlContent += '<div class="stat-box"><div class="stat-label">Current Streak</div><div class="stat-value">' + stats[player].currentStreak + '</div></div>';
                htmlContent += '<div class="stat-box"><div class="stat-label">Max Streak</div><div class="stat-value">' + stats[player].maxStreak + '</div></div>';
                htmlContent += '</div>';
                
                if (runsRuts.length > 0) {
                    htmlContent += '<h4 style="margin-top: 15px; margin-bottom: 10px; font-weight: 600;">Notable Runs & Ruts (15+ games)</h4>';
                    runsRuts.forEach(period => {
                        htmlContent += '<div class="' + period.type + '"><strong>Wordle ' + period.start + ' - ' + period.end + '</strong><span style="font-size: 0.875rem; color: #6b7280; margin-left: 8px;">(' + period.length + ' games)</span><span style="float: right; font-weight: 600;">';
                        htmlContent += (period.type === 'run' ? 'üî• RUN' : 'üò∞ RUT') + ' - Avg: ' + period.avg + ' (' + (period.diff > 0 ? '+' : '') + period.diff + ')</span></div>';
                    });
                }
                htmlContent += '</div>';
            });
            
            htmlContent += '</div></div>';
            
            // Add script with embedded data
            htmlContent += '<script>const players = ' + JSON.stringify(players) + ';';
            htmlContent += 'const scores = ' + JSON.stringify(scores) + ';';
            htmlContent += 'const playerColors = ["#ef4444", "#3b82f6", "#10b981", "#f59e0b", "#8b5cf6", "#ec4899"];';
            htmlContent += 'function drawChart() { const canvas = document.getElementById("chart"); const ctx = canvas.getContext("2d"); const width = canvas.width = canvas.offsetWidth * 2; const height = canvas.height = 800; ctx.clearRect(0, 0, width, height); const padding = { top: 40, right: 200, bottom: 60, left: 80 }; const chartWidth = width - padding.left - padding.right; const chartHeight = height - padding.top - padding.bottom; const wordleNumbers = [...new Set(scores.map(d => d.wordleNumber))].sort((a, b) => a - b); const avgData = wordleNumbers.map((num) => { const entry = { wordleNumber: num }; players.forEach(player => { const playerScores = scores.filter(d => d.player === player && d.wordleNumber <= num); const validScores = playerScores.filter(s => s.score <= 6); if (validScores.length > 0) { entry[player] = validScores.reduce((sum, s) => sum + s.score, 0) / validScores.length; } }); return entry; }); const minY = 3.6, maxY = 4.5; const xScale = chartWidth / (avgData.length - 1 || 1); const yScale = chartHeight / (maxY - minY); ctx.strokeStyle = "#e5e7eb"; ctx.lineWidth = 1; for (let y = 3.6; y <= 4.5; y += 0.1) { const yPos = padding.top + chartHeight - ((y - minY) * yScale); ctx.beginPath(); ctx.moveTo(padding.left, yPos); ctx.lineTo(width - padding.right, yPos); ctx.stroke(); if (Math.abs(y % 0.2) < 0.01) { ctx.fillStyle = "#6b7280"; ctx.font = "24px sans-serif"; ctx.textAlign = "right"; ctx.fillText(y.toFixed(1), padding.left - 15, yPos + 8); } } ctx.strokeStyle = "#374151"; ctx.lineWidth = 3; ctx.beginPath(); ctx.moveTo(padding.left, padding.top); ctx.lineTo(padding.left, height - padding.bottom); ctx.lineTo(width - padding.right, height - padding.bottom); ctx.stroke(); players.forEach((player, idx) => { ctx.strokeStyle = playerColors[idx % playerColors.length]; ctx.lineWidth = 4; ctx.beginPath(); let started = false; avgData.forEach((d, i) => { if (d[player] !== undefined && d[player] >= minY && d[player] <= maxY) { const x = padding.left + (i * xScale); const y = padding.top + chartHeight - ((d[player] - minY) * yScale); if (!started) { ctx.moveTo(x, y); started = true; } else { ctx.lineTo(x, y); } } }); ctx.stroke(); }); players.forEach((player, idx) => { const y = padding.top + (idx * 50); ctx.fillStyle = playerColors[idx % playerColors.length]; ctx.fillRect(width - padding.right + 20, y, 40, 6); ctx.fillStyle = "#374151"; ctx.font = "28px sans-serif"; ctx.textAlign = "left"; ctx.fillText(player, width - padding.right + 70, y + 8); }); ctx.fillStyle = "#1f2937"; ctx.font = "bold 32px sans-serif"; ctx.textAlign = "center"; ctx.fillText("Cumulative Average Over Time", width / 2, 30); } window.onload = drawChart;</script></body></html>';
            
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'wordle-results-' + new Date().toISOString().split('T')[0] + '.html';
            a.click();
            URL.revokeObjectURL(url);
            
            alert('‚úÖ Results exported!\n\nShare the HTML file via WhatsApp/Email.\nYour friends can open it in any browser to see all the results with the graph!');
        }

        function displayResults() {
            const scores = currentMode === 'raw' ? rawData : penaltyData;
            const stats = calculateStats(scores, players);
            
            const winner = players.reduce((best, player) => {
                const playerAvg = parseFloat(stats[player].weekAverage);
                const bestAvg = parseFloat(stats[best].weekAverage);
                if (isNaN(playerAvg)) return best;
                if (isNaN(bestAvg)) return player;
                return playerAvg < bestAvg ? player : best;
            });
            
            let html = '<div class="winner-banner"><h2 style="font-size: 2rem; margin-bottom: 10px;">üèÜ Wordler of the Week üèÜ</h2><p style="font-size: 1.5rem; font-weight: 600;">' + winner + '</p></div>';
            
            html += '<div class="card"><h2>Performance Summary</h2><table><thead><tr><th>Player</th><th class="text-center">Week Avg</th><th class="text-center">All-Time</th><th class="text-center">Streak</th><th class="text-center">Max</th></tr></thead><tbody>';
            
            players.sort((a, b) => parseFloat(stats[a].average) - parseFloat(stats[b].average)).forEach(player => {
                html += '<tr><td style="font-weight: 600;">' + player + '</td><td class="text-center">' + stats[player].weekAverage + '</td><td class="text-center text-green">' + stats[player].average + '</td><td class="text-center">' + stats[player].currentStreak + '</td><td class="text-center">' + stats[player].maxStreak + '</td></tr>';
            });
            
            html += '</tbody></table></div>';
            
            html += '<div class="card"><h2>Cumulative Average Chart</h2><canvas id="chartCanvas"></canvas></div>';
            
            html += '<div class="card"><h2>Detailed Player Statistics</h2>';
            
            players.forEach(player => {
                const runsRuts = getRunsAndRuts(player, scores);
                html += '<div style="margin-bottom: 30px; padding-bottom: 30px; border-bottom: 1px solid #e5e7eb;"><h3 style="font-size: 1.25rem; margin-bottom: 15px;">' + player + '</h3><div class="stat-grid">';
                html += '<div class="stat-box"><div class="stat-label">All-Time Average</div><div class="stat-value text-green">' + stats[player].average + '</div></div>';
                html += '<div class="stat-box"><div class="stat-label">Week Average</div><div class="stat-value">' + stats[player].weekAverage + '</div></div>';
                html += '<div class="stat-box"><div class="stat-label">Current Streak</div><div class="stat-value">' + stats[player].currentStreak + '</div></div>';
                html += '<div class="stat-box"><div class="stat-label">Max Streak</div><div class="stat-value">' + stats[player].maxStreak + '</div></div>';
                html += '</div>';
                
                if (runsRuts.length > 0) {
                    html += '<h4 style="margin-top: 15px; margin-bottom: 10px; font-weight: 600;">Notable Runs & Ruts (15+ games)</h4>';
                    runsRuts.forEach(period => {
                        html += '<div class="' + period.type + '"><strong>Wordle ' + period.start + ' - ' + period.end + '</strong><span style="font-size: 0.875rem; color: #6b7280; margin-left: 8px;">(' + period.length + ' games)</span><span style="float: right; font-weight: 600;">';
                        html += (period.type === 'run' ? 'üî• RUN' : 'üò∞ RUT') + ' - Avg: ' + period.avg + ' (' + (period.diff > 0 ? '+' : '') + period.diff + ')</span></div>';
                    });
                }
                html += '</div>';
            });
            
            html += '</div>';
            
            document.getElementById('results').innerHTML = html;
            document.getElementById('results').classList.remove('hidden');
            
            setTimeout(function() { drawChart('chartCanvas', scores); }, 100);
        }
    </script>
</body>
</html>
